
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
	<script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>

	<style>
		* {
			font-family: '微软雅黑';
		}

		label {
			font-size: 15px;
			margin-right: 15px;
		}
	</style>
	<script type="application/javascript">
		var timeMap = new Map();
		$(function () {
			$('#startBtn').click(function () {
				var allContent = $('#parseArea').val();
				var parseArea;
				var paramArea;
				if (allContent.indexOf("\n") > 0) {
					var contentArr = allContent.split("\n");
					parseArea = contentArr[0];
					if (parseArea.indexOf("Preparing:") > 0) {
						parseArea = parseArea.split("Preparing:")[1];
						$('#parseArea').val(parseArea);
					}
					paramArea = contentArr[1];
					if (paramArea.indexOf("Parameters:") > 0) {
						paramArea = paramArea.split("Parameters:")[1];
						$('#paramArea').val(paramArea);
					}
				} else {
					parseArea = $('#parseArea').val();
					paramArea = $('#paramArea').val();
				}
				var outputData = "";
				if (parseArea && paramArea) {
					var paramAreaArr = paramArea.split(", "); 
					for (var i = 0; i < paramAreaArr.length; i++) {
						var param = paramAreaArr[i];
						if (param.indexOf("(String)") >= 0) {
							parseArea = parseArea.replace("\?", "'" + param.replace("(String)", "").trim() + "'" );
						} else if (param.indexOf("(Integer)") >= 0) {
							parseArea = parseArea.replace("\?", param.replace("(Integer)", "").trim());
						} else if (param.indexOf("(Short)") >= 0) {
							parseArea = parseArea.replace("\?", param.replace("(Short)", "").trim());
						} else if (param.indexOf("(Timestamp)") >= 0) {
							parseArea = parseArea.replace("\?", "'" + param.replace("(Timestamp)", "").trim() + "'");
						}
					}
					$('#outputArea').val(replaceSpacesWithNewlines(parseArea));
				} else {
					alert("请输入SQL和Parameter的内容。");
				}
			});

			$('#cleanInputBtn').click(function () {
				$('#parseArea').val('');
				$('#paramArea').val('');
				$('#outputArea').val('');
				$('#consoleArea').val('');
			});

			$('#cleanOutputBtn').click(function () {
				$('#outputArea').val('');
				$('#consoleArea').val('');
			});

			$('.removeBtn').click(function () {
				removeFiled($(this));
			});

			$('#commentLang').change(function(){
				loadCommentLang();
			});
		});

		function errorLog(msg) {
			log('ERROR', msg);
			$('#consoleArea').focus();
		}

		function warnLog(msg) {
			log('WARN ', msg);
		}

		function startLog(msg) {
			startTime(msg);
			infoLog($.sprintf('{0}处理开始！', msg));
		}

		function endLog(msg) {
			var time = endTime(msg);
			infoLog($.sprintf('{0}处理结束！共耗时：{1}ms', msg, time));
		}

		function infoLog(msg) {
			log('INFO ', msg);
		}

		function debugLog(msg) {
			log('DEBUG', msg);
		}

		function log(level, msg) {
			var date = (new Date()).Format("yyyy-MM-dd HH:mm:ss.S");
			msg = $.sprintf('[{0}] [{1}] {2}\r\n', level, date, msg);
			var logContent = $('#consoleArea').val();
			if (logContent) {
				msg = logContent + msg;
			}
			$('#consoleArea').val(msg);
		}

		function startTime(key) {
			timeMap.set(key, new Date().getTime());
		}

		function endTime(key) {
			if (timeMap.get(key)) {
				var time = new Date().getTime();
				return time - timeMap.get(key);
			} else {
				warnLog(key + ' not started.');
				return 0;
			}
		}

		$.extend({
			sprintf: function (format) {
				for (var i = 1; i < arguments.length; i++) {
					var reg = new RegExp('\\{' + (i - 1) + '\\}', 'g');
					format = format.replace(reg, arguments[i]);
				}
				return format;
			}
		});

		// 对Date的扩展，将 Date 转化为指定格式的String   
		// 月(M)、日(d)、小时(H)、分(m)、秒(s)、季度(q) 可以用 1-2 个占位符，   
		// 年(y)可以用 1-4 个占位符，毫秒(S)只能用 1 个占位符(是 1-3 位的数字)   
		// 例子：   
		// (new Date()).Format("yyyy-MM-dd HH:mm:ss.S") ==> 2006-07-02 08:09:04.423   
		// (new Date()).Format("yyyy-M-d H:m:s.S")	  ==> 2006-7-2 8:9:4.18   
		Date.prototype.Format = function (fmt) { //author: meizz   
			var o = {
				"M+": this.getMonth() + 1,			   //月份   
				"d+": this.getDate(),					//日   
				"H+": this.getHours(),				   //小时   
				"m+": this.getMinutes(),				 //分   
				"s+": this.getSeconds(),				 //秒   
				"q+": Math.floor((this.getMonth() + 3) / 3), //季度   
				"S": this.getMilliseconds()			 //毫秒   
			};
			if (/(y+)/.test(fmt))
				fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
			for (var k in o)
				if (new RegExp("(" + k + ")").test(fmt))
					fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
			return fmt;
		}

		function replaceSpacesWithNewlines(inputString) {
			let inQuotes = false;
			let shouldSkipNextSpace = false;
			let result = '';

			for (let i = 0; i < inputString.length; i++) {
				if (inputString[i] === "'") {
					inQuotes = !inQuotes;
					result += inputString[i];
				} else if (inputString[i] === '-' && inputString[i + 1] === '-') {
					result += inputString[i];
					result += inputString[++i]; // Skip the next '-'
					if (inputString[i + 1] === ' ') {
						shouldSkipNextSpace = true;
						result += inputString[++i]; // Skip the space after '--'
					}
				} else if (inputString[i] === ' ' && !inQuotes && !shouldSkipNextSpace) {
					result += '\n';
				} else {
					result += inputString[i];
					shouldSkipNextSpace = false; // Reset after processing the space
				}
			}

			return result;
		}

	</script>
</head>

<body>
	<div style="margin: auto; width: 1050px;">
		SQL:
		<br />
		<div style="display: inline-block; width: 820px;">
			<textarea id="parseArea" rows="15" style="width:800px"></textarea>
		</div>
		<br />
		Parameter：
		<br />
		<div style="display: inline-block; width: 820px;">
			<textarea id="paramArea" rows="5" style="width:800px"></textarea>
		</div>
		<br />
		<fieldset style="width: 771px;">
			<legend>操作</legend>
			<button id="startBtn">开始转换</button>
			<button id="cleanInputBtn">重置页面</button>
			<button id="cleanOutputBtn">清空结果</button>
		</fieldset>
		↓↓↓↓
		<br />
		<textarea id="outputArea" rows="20" style="width:800px"></textarea>
		<br />
		<br />
		Console:<br />
		<textarea id="consoleArea" rows="15" style="width:800px"></textarea>
	</div>
</body>

</html>
